<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://th815.github.io</id>
    <title>ç”°æ˜Š</title>
    <updated>2020-09-14T09:29:47.686Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://th815.github.io"/>
    <link rel="self" href="https://th815.github.io/atom.xml"/>
    <subtitle>è®°å½•æˆé•¿ç‚¹æ»´</subtitle>
    <logo>https://th815.github.io/images/avatar.png</logo>
    <icon>https://th815.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, ç”°æ˜Š</rights>
    <entry>
        <title type="html"><![CDATA[Docker å’Œ Kubernetes ä»å¬è¿‡åˆ°ç•¥æ‡‚ï¼šç»™ç¨‹åºå‘˜çš„æ—‹é£æ•™ç¨‹]]></title>
        <id>https://th815.github.io/post/docker-he-kubernetes-cong-ting-guo-dao-lue-dong-gei-cheng-xu-yuan-de-xuan-feng-jiao-cheng/</id>
        <link href="https://th815.github.io/post/docker-he-kubernetes-cong-ting-guo-dao-lue-dong-gei-cheng-xu-yuan-de-xuan-feng-jiao-cheng/">
        </link>
        <updated>2020-09-14T08:56:39.000Z</updated>
        <content type="html"><![CDATA[<!-- more -->
<p>æ—©åœ¨ Docker æ­£å¼å‘å¸ƒå‡ ä¸ªæœˆçš„æ—¶å€™ï¼Œ<a href="https://www.leancloud.cn/">LeanCloud</a> å°±å¼€å§‹åœ¨ç”Ÿäº§ç¯å¢ƒå¤§è§„æ¨¡ä½¿ç”¨ Dockerï¼Œåœ¨è¿‡å»å‡ å¹´é‡Œ Docker çš„æŠ€æœ¯æ ˆæ”¯æ’‘äº†æˆ‘ä»¬ä¸»è¦çš„åç«¯æ¶æ„ã€‚è¿™æ˜¯ä¸€ç¯‡å†™ç»™ç¨‹åºå‘˜çš„ Docker å’Œ Kubernetes æ•™ç¨‹ï¼Œç›®çš„æ˜¯è®©ç†Ÿæ‚‰æŠ€æœ¯çš„è¯»è€…åœ¨å°½å¯èƒ½çŸ­çš„æ—¶é—´å†…å¯¹ Docker å’Œ Kubernetes æœ‰åŸºæœ¬çš„äº†è§£ï¼Œå¹¶é€šè¿‡å®é™…éƒ¨ç½²ã€å‡çº§ã€å›æ»šä¸€ä¸ªæœåŠ¡ä½“éªŒå®¹å™¨åŒ–ç”Ÿäº§ç¯å¢ƒçš„åŸç†å’Œå¥½å¤„ã€‚æœ¬æ–‡å‡è®¾è¯»è€…éƒ½æ˜¯å¼€å‘è€…ï¼Œå¹¶ç†Ÿæ‚‰ Mac/Linux ç¯å¢ƒï¼Œæ‰€ä»¥å°±ä¸ä»‹ç»åŸºç¡€çš„æŠ€æœ¯æ¦‚å¿µäº†ã€‚å‘½ä»¤è¡Œç¯å¢ƒä»¥ Mac ç¤ºä¾‹ï¼Œåœ¨ Linux ä¸‹åªè¦æ ¹æ®è‡ªå·±ä½¿ç”¨çš„å‘è¡Œç‰ˆå’ŒåŒ…ç®¡ç†å·¥å…·åšè°ƒæ•´å³å¯ã€‚<br>
Docker é€Ÿæˆ<br>
é¦–å…ˆå¿«é€Ÿåœ°ä»‹ç»ä¸€ä¸‹ Dockerï¼šä½œä¸ºç¤ºä¾‹ï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°å¯åŠ¨ Docker çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œå¹¶åœ¨ä¸€ä¸ªå®¹å™¨é‡Œè¿è¡Œç®€å•çš„ HTTP æœåŠ¡ã€‚å…ˆå®Œæˆå®‰è£…ï¼š</p>
<pre><code>$ brew cask install docker
</code></pre>
<p>å¤åˆ¶ä»£ç ä¸Šé¢çš„å‘½ä»¤ä¼šä» <a href="https://brew.sh/">Homebrew</a> å®‰è£… Docker for Macï¼Œå®ƒåŒ…å« Docker çš„åå°è¿›ç¨‹å’Œå‘½ä»¤è¡Œå·¥å…·ã€‚Docker çš„åå°è¿›ç¨‹ä»¥ä¸€ä¸ª Mac App çš„å½¢å¼å®‰è£…åœ¨ /Applications é‡Œï¼Œéœ€è¦æ‰‹åŠ¨å¯åŠ¨ã€‚å¯åŠ¨ Docker åº”ç”¨åï¼Œå¯ä»¥åœ¨ Terminal é‡Œç¡®è®¤ä¸€ä¸‹å‘½ä»¤è¡Œå·¥å…·çš„ç‰ˆæœ¬ï¼š</p>
<pre><code>$ docker --version
Docker version 18.03.1-ce, build 9ee9f40
</code></pre>
<p>å¤åˆ¶ä»£ç ä¸Šé¢æ˜¾ç¤ºçš„ Docker ç‰ˆæœ¬å¯èƒ½å’Œæˆ‘çš„ä¸ä¸€æ ·ï¼Œä½†åªè¦ä¸æ˜¯å¤ªè€å°±å¥½ã€‚æˆ‘ä»¬å»ºä¸€ä¸ªå•ç‹¬çš„ç›®å½•æ¥å­˜æ”¾ç¤ºä¾‹æ‰€éœ€çš„æ–‡ä»¶ã€‚ä¸ºäº†å°½é‡ç®€åŒ–ä¾‹å­ï¼Œæˆ‘ä»¬è¦éƒ¨ç½²çš„æœåŠ¡æ˜¯ç”¨ Nginx æ¥ serve ä¸€ä¸ªç®€å•çš„ HTML æ–‡ä»¶ <code>html/index.html</code>ã€‚</p>
<pre><code>$ mkdir docker-demo
$ cd docker-demo
$ mkdir html
$ echo '&lt;h1&gt;Hello Docker!&lt;/h1&gt;' &gt; html/index.html
</code></pre>
<p>å¤åˆ¶ä»£ç æ¥ä¸‹æ¥åœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ªå« Dockerfile çš„æ–°æ–‡ä»¶ï¼ŒåŒ…å«ä¸‹é¢çš„å†…å®¹ï¼š<br>
FROM nginx</p>
<pre><code>COPY html/* /usr/share/nginx/html
</code></pre>
<p>å¤åˆ¶ä»£ç æ¯ä¸ª Dockerfile éƒ½ä»¥ <code>FROM ...</code>å¼€å¤´ã€‚<code>FROM nginx</code> çš„æ„æ€æ˜¯ä»¥ Nginx å®˜æ–¹æä¾›çš„é•œåƒä¸ºåŸºç¡€æ¥æ„å»ºæˆ‘ä»¬çš„é•œåƒã€‚åœ¨æ„å»ºæ—¶ï¼ŒDocker ä¼šä» Docker Hub æŸ¥æ‰¾å’Œä¸‹è½½éœ€è¦çš„é•œåƒã€‚Docker Hub å¯¹äº Docker é•œåƒçš„ä½œç”¨å°±åƒ GitHub å¯¹äºä»£ç çš„ä½œç”¨ä¸€æ ·ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ‰˜ç®¡å’Œå…±äº«é•œåƒçš„æœåŠ¡ã€‚ä½¿ç”¨è¿‡å’Œæ„å»ºçš„é•œåƒéƒ½ä¼šè¢«ç¼“å­˜åœ¨æœ¬åœ°ã€‚ç¬¬äºŒè¡ŒæŠŠæˆ‘ä»¬çš„é™æ€æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒçš„ <code>/usr/share/nginx/html</code> ç›®å½•ä¸‹ã€‚ä¹Ÿå°±æ˜¯ Nginx å¯»æ‰¾é™æ€æ–‡ä»¶çš„ç›®å½•ã€‚Dockerfile åŒ…å«æ„å»ºé•œåƒçš„æŒ‡ä»¤ï¼Œæ›´è¯¦ç»†çš„ä¿¡æ¯å¯ä»¥å‚è€ƒè¿™é‡Œã€‚<br>
ç„¶åå°±å¯ä»¥æ„å»ºé•œåƒäº†ï¼š</p>
<pre><code>$ docker build -t docker-demo:0.1 .
</code></pre>
<p>å¤åˆ¶ä»£ç è¯·ç¡®ä¿ä½ æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤ä¸ºè¿™ä¸ªå®éªŒæ–°å»ºäº†ç›®å½•ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªç›®å½•ä¸­è¿è¡Œ <code>docker build</code>ã€‚å¦‚æœä½ åœ¨å…¶å®ƒæœ‰å¾ˆå¤šæ–‡ä»¶çš„ç›®å½•ï¼ˆæ¯”å¦‚ä½ çš„ç”¨æˆ·ç›®å½•æˆ–è€… <code>/tmp</code> ï¼‰è¿è¡Œï¼Œdocker ä¼šæŠŠå½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶ä½œä¸ºä¸Šä¸‹æ–‡å‘é€ç»™è´Ÿè´£æ„å»ºçš„åå°è¿›ç¨‹ã€‚<br>
è¿™è¡Œå‘½ä»¤ä¸­çš„åç§°<code>docker-demo</code> å¯ä»¥ç†è§£ä¸ºè¿™ä¸ªé•œåƒå¯¹åº”çš„åº”ç”¨åæˆ–æœåŠ¡åï¼Œ<code>0.1</code> æ˜¯æ ‡ç­¾ã€‚Docker é€šè¿‡åç§°å’Œæ ‡ç­¾çš„ç»„åˆæ¥æ ‡è¯†é•œåƒã€‚å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥çœ‹åˆ°åˆšåˆšåˆ›å»ºçš„é•œåƒï¼š</p>
<pre><code>$ docker image ls
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
docker-demo         0.1                 efb8ca048d5a        5 minutes ago       109M 
</code></pre>
<p>å¤åˆ¶ä»£ç ä¸‹é¢æˆ‘ä»¬æŠŠè¿™ä¸ªé•œåƒè¿è¡Œèµ·æ¥ã€‚Nginx é»˜è®¤ç›‘å¬åœ¨ 80 ç«¯å£ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå®¿ä¸»æœºçš„ 8080 ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ 80 ç«¯å£ï¼š<br>
$ docker run --name docker-demo -d -p 8080:80 docker-demo:0.1<br>
å¤åˆ¶ä»£ç ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°æ­£åœ¨è¿è¡Œä¸­çš„å®¹å™¨ï¼š</p>
<pre><code>$ docker container ps
CONTAINER ID  IMAGE            ...  PORTS                 NAMES
c495a7ccf1c7  docker-demo:0.1  ...  0.0.0.0:8080-&gt;80/tcp  docker-demo
</code></pre>
<p>å¤åˆ¶ä»£ç è¿™æ—¶å¦‚æœä½ ç”¨æµè§ˆå™¨è®¿é—® http://localhost:8080ï¼Œå°±èƒ½çœ‹åˆ°æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„ã€ŒHello Docker!ã€é¡µé¢ã€‚<br>
åœ¨ç°å®çš„ç”Ÿäº§ç¯å¢ƒä¸­ Docker æœ¬èº«æ˜¯ä¸€ä¸ªç›¸å¯¹åº•å±‚çš„å®¹å™¨å¼•æ“ï¼Œåœ¨æœ‰å¾ˆå¤šæœåŠ¡å™¨çš„é›†ç¾¤ä¸­ï¼Œä¸å¤ªå¯èƒ½ä»¥ä¸Šé¢çš„æ–¹å¼æ¥ç®¡ç†ä»»åŠ¡å’Œèµ„æºã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ Kubernetes è¿™æ ·çš„ç³»ç»Ÿæ¥è¿›è¡Œä»»åŠ¡çš„ç¼–æ’å’Œè°ƒåº¦ã€‚åœ¨è¿›å…¥ä¸‹ä¸€æ­¥å‰ï¼Œåˆ«å¿˜äº†æŠŠå®éªŒç”¨çš„å®¹å™¨æ¸…ç†æ‰ï¼š</p>
<pre><code>$ docker container stop docker-demo
$ docker container rm docker-demo
</code></pre>
<p>å¤åˆ¶ä»£ç å®‰è£… Kubernetes<br>
ä»‹ç»å®Œ Dockerï¼Œç»ˆäºå¯ä»¥å¼€å§‹è¯•è¯• Kubernetes äº†ã€‚æˆ‘ä»¬éœ€è¦å®‰è£…ä¸‰æ ·ä¸œè¥¿ï¼šKubernetes çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯ kubctlã€ä¸€ä¸ªå¯ä»¥åœ¨æœ¬åœ°è·‘èµ·æ¥çš„ Kubernetes ç¯å¢ƒ Minikubeã€ä»¥åŠç»™ Minikube ä½¿ç”¨çš„è™šæ‹ŸåŒ–å¼•æ“ xhyveã€‚</p>
<pre><code>$ brew install kubectl
$ brew cask install minikube
$ brew install docker-machine-driver-xhyve
</code></pre>
<p>å¤åˆ¶ä»£ç Minikube é»˜è®¤çš„è™šæ‹ŸåŒ–å¼•æ“æ˜¯ VirtualBoxï¼Œè€Œ xhyve æ˜¯ä¸€ä¸ªæ›´è½»é‡ã€æ€§èƒ½æ›´å¥½çš„æ›¿ä»£ã€‚å®ƒéœ€è¦ä»¥ root æƒé™è¿è¡Œï¼Œæ‰€ä»¥å®‰è£…å®Œè¦æŠŠæ‰€æœ‰è€…æ”¹ä¸º <code>root:wheel</code>ï¼Œå¹¶æŠŠ setuid æƒé™æ‰“å¼€ï¼š</p>
<pre><code class="language-$">$ sudo chmod u+s /usr/local/opt/docker-machine-driver-xhyve/bin/docker-machine-driver-xhyve~~~~
å¤åˆ¶ä»£ç ç„¶åå°±å¯ä»¥å¯åŠ¨ Minikube äº†ï¼š
~~~~$ minikube start --vm-driver xhyve~~~~
å¤åˆ¶ä»£ç ä½ å¤šåŠä¼šçœ‹åˆ°ä¸€ä¸ªè­¦å‘Šè¯´ xhyve ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬è¢« hyperkit æ›¿ä»£ï¼Œæ¨èä½¿ç”¨ hyperkitã€‚ä¸è¿‡åœ¨æˆ‘å†™è¿™ä¸ªæ•™ç¨‹çš„æ—¶å€™ docker-machine-driver-hyperkit è¿˜æ²¡æœ‰è¿›å…¥ Homebrew, éœ€è¦æ‰‹åŠ¨ç¼–è¯‘å’Œå®‰è£…ï¼Œæˆ‘å°±å·ä¸ªæ‡’ï¼Œä»ç„¶ç”¨ xhyveã€‚ä»¥ååªè¦åœ¨å®‰è£…å’Œè¿è¡Œçš„å‘½ä»¤ä¸­æŠŠ xhyve æ”¹ä¸º hyperkit å°±å¯ä»¥ã€‚
å¦‚æœä½ åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨ Minikube æ—¶é‡åˆ°é”™è¯¯æˆ–è¢«ä¸­æ–­ï¼Œåé¢é‡è¯•ä»ç„¶å¤±è´¥æ—¶ï¼Œå¯ä»¥å°è¯•è¿è¡Œ `minikube delete` æŠŠé›†ç¾¤åˆ é™¤ï¼Œé‡æ–°æ¥è¿‡ã€‚
Minikube å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨é…ç½® kubectlï¼ŒæŠŠå®ƒæŒ‡å‘ Minikube æä¾›çš„ Kubernetes API æœåŠ¡ã€‚å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ç¡®è®¤ï¼š

</code></pre>
<p>$ kubectl config current-context<br>
minikube</p>
<pre><code>
å¤åˆ¶ä»£ç Kubernetes æ¶æ„ç®€ä»‹
å…¸å‹çš„ Kubernetes é›†ç¾¤åŒ…å«ä¸€ä¸ª master å’Œå¾ˆå¤š nodeã€‚Master æ˜¯æ§åˆ¶é›†ç¾¤çš„ä¸­å¿ƒï¼Œnode æ˜¯æä¾› CPUã€å†…å­˜å’Œå­˜å‚¨èµ„æºçš„èŠ‚ç‚¹ã€‚Master ä¸Šè¿è¡Œç€å¤šä¸ªè¿›ç¨‹ï¼ŒåŒ…æ‹¬é¢å‘ç”¨æˆ·çš„ API æœåŠ¡ã€è´Ÿè´£ç»´æŠ¤é›†ç¾¤çŠ¶æ€çš„ Controller Managerã€è´Ÿè´£è°ƒåº¦ä»»åŠ¡çš„ Scheduler ç­‰ã€‚æ¯ä¸ª node ä¸Šè¿è¡Œç€ç»´æŠ¤ node çŠ¶æ€å¹¶å’Œ master é€šä¿¡çš„ kubeletï¼Œä»¥åŠå®ç°é›†ç¾¤ç½‘ç»œæœåŠ¡çš„ kube-proxyã€‚
ä½œä¸ºä¸€ä¸ªå¼€å‘å’Œæµ‹è¯•çš„ç¯å¢ƒï¼ŒMinikube ä¼šå»ºç«‹ä¸€ä¸ªæœ‰ä¸€ä¸ª node çš„é›†ç¾¤ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°ï¼š

</code></pre>
<p>$ kubectl get nodes<br>
NAME       STATUS    AGE       VERSION<br>
minikube   Ready     1h        v1.10.0</p>
<pre><code>
å¤åˆ¶ä»£ç éƒ¨ç½²ä¸€ä¸ªå•å®ä¾‹æœåŠ¡
æˆ‘ä»¬å…ˆå°è¯•åƒæ–‡ç« å¼€å§‹ä»‹ç» Docker æ—¶ä¸€æ ·ï¼Œéƒ¨ç½²ä¸€ä¸ªç®€å•çš„æœåŠ¡ã€‚Kubernetes ä¸­éƒ¨ç½²çš„æœ€å°å•ä½æ˜¯ podï¼Œè€Œä¸æ˜¯ Docker å®¹å™¨ã€‚å®æ—¶ä¸Š Kubernetes æ˜¯ä¸ä¾èµ–äº Docker çš„ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨å…¶ä»–çš„å®¹å™¨å¼•æ“åœ¨ Kubernetes ç®¡ç†çš„é›†ç¾¤ä¸­æ›¿ä»£ Dockerã€‚åœ¨ä¸ Docker ç»“åˆä½¿ç”¨æ—¶ï¼Œä¸€ä¸ª pod ä¸­å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª Docker å®¹å™¨ã€‚ä½†é™¤äº†æœ‰ç´§å¯†è€¦åˆçš„æƒ…å†µä¸‹ï¼Œé€šå¸¸ä¸€ä¸ª pod ä¸­åªæœ‰ä¸€ä¸ªå®¹å™¨ï¼Œè¿™æ ·æ–¹ä¾¿ä¸åŒçš„æœåŠ¡å„è‡ªç‹¬ç«‹åœ°æ‰©å±•ã€‚
Minikube è‡ªå¸¦äº† Docker å¼•æ“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é‡æ–°é…ç½®å®¢æˆ·ç«¯ï¼Œè®© docker å‘½ä»¤è¡Œä¸ Minikube ä¸­çš„ Docker è¿›ç¨‹é€šè®¯ï¼š
~~~~$ eval $(minikube docker-env)~~~~
å¤åˆ¶ä»£ç åœ¨è¿è¡Œä¸Šé¢çš„å‘½ä»¤åï¼Œå†è¿è¡Œ` docker image ls` æ—¶åªèƒ½çœ‹åˆ°ä¸€äº› Minikube è‡ªå¸¦çš„é•œåƒï¼Œå°±çœ‹ä¸åˆ°æˆ‘ä»¬åˆšæ‰æ„å»ºçš„ docker-demo:0.1 é•œåƒäº†ã€‚æ‰€ä»¥åœ¨ç»§ç»­ä¹‹å‰ï¼Œè¦é‡æ–°æ„å»ºä¸€éæˆ‘ä»¬çš„é•œåƒï¼Œè¿™é‡Œé¡ºä¾¿æ”¹ä¸€ä¸‹åå­—ï¼Œå«å®ƒ k8s-demo:0.1ã€‚
~~~~$ docker build -t k8s-demo:0.1 .~~~~
å¤åˆ¶ä»£ç ç„¶ååˆ›å»ºä¸€ä¸ªå« pod.yml çš„å®šä¹‰æ–‡ä»¶ï¼š
~~~~apiVersion: v1
kind: Pod
metadata:
  name: k8s-demo
spec:
  containers:
    - name: k8s-demo
      image: k8s-demo:0.1
      ports:
        - containerPort: 80~~~~
å¤åˆ¶ä»£ç è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå« k8s-demo çš„ Podï¼Œä½¿ç”¨æˆ‘ä»¬åˆšæ‰æ„å»ºçš„ k8s-demo:0.1 é•œåƒã€‚è¿™ä¸ªæ–‡ä»¶ä¹Ÿå‘Šè¯‰ Kubernetes å®¹å™¨å†…çš„è¿›ç¨‹ä¼šç›‘å¬ 80 ç«¯å£ã€‚ç„¶åæŠŠå®ƒè·‘èµ·æ¥ï¼š
~~~~$ kubectl create -f pod.yml
pod &quot;k8s-demo&quot; created~~~~
å¤åˆ¶ä»£ç kubectl æŠŠè¿™ä¸ªæ–‡ä»¶æäº¤ç»™ Kubernetes API æœåŠ¡ï¼Œç„¶å Kubernetes Master ä¼šæŒ‰ç…§è¦æ±‚æŠŠ Pod åˆ†é…åˆ° node ä¸Šã€‚ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–°å»ºçš„ Podï¼š
~~~~$ kubectl get pods
NAME       READY     STATUS    RESTARTS   AGE
k8s-demo   1/1       Running   0          5s~~~~
å¤åˆ¶ä»£ç å› ä¸ºæˆ‘ä»¬çš„é•œåƒåœ¨æœ¬åœ°ï¼Œå¹¶ä¸”è¿™ä¸ªæœåŠ¡ä¹Ÿå¾ˆç®€å•ï¼Œæ‰€ä»¥è¿è¡Œ` kubectl get pods `çš„æ—¶å€™ STATUS å·²ç»æ˜¯ runningã€‚è¦æ˜¯ä½¿ç”¨è¿œç¨‹é•œåƒï¼ˆæ¯”å¦‚ Docker Hub ä¸Šçš„é•œåƒï¼‰ï¼Œä½ çœ‹åˆ°çš„çŠ¶æ€å¯èƒ½ä¸æ˜¯ Runningï¼Œå°±éœ€è¦å†ç­‰å¾…ä¸€ä¸‹ã€‚
è™½ç„¶è¿™ä¸ª pod åœ¨è¿è¡Œï¼Œä½†æ˜¯æˆ‘ä»¬æ˜¯æ— æ³•åƒä¹‹å‰æµ‹è¯• Docker æ—¶ä¸€æ ·ç”¨æµè§ˆå™¨è®¿é—®å®ƒè¿è¡Œçš„æœåŠ¡çš„ã€‚å¯ä»¥ç†è§£ä¸º pod éƒ½è¿è¡Œåœ¨ä¸€ä¸ªå†…ç½‘ï¼Œæˆ‘ä»¬æ— æ³•ä»å¤–éƒ¨ç›´æ¥è®¿é—®ã€‚è¦æŠŠæœåŠ¡æš´éœ²å‡ºæ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª Serviceã€‚Service çš„ä½œç”¨æœ‰ç‚¹åƒå»ºç«‹äº†ä¸€ä¸ªåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨ï¼Œè´Ÿè´£æŠŠè¯·æ±‚åˆ†å‘ç»™åé¢çš„ podã€‚
åˆ›å»ºä¸€ä¸ª Service çš„å®šä¹‰æ–‡ä»¶ svc.ymlï¼š
~~~~apiVersion: v1
kind: Service
metadata:
  name: k8s-demo-svc
  labels:
    app: k8s-demo
spec:
  type: NodePort
  ports:
    - port: 80
      nodePort: 30050
  selector:
    app: k8s-demo~~~~
å¤åˆ¶ä»£ç è¿™ä¸ª service ä¼šæŠŠå®¹å™¨çš„ 80 ç«¯å£ä» node çš„ 30050 ç«¯å£æš´éœ²å‡ºæ¥ã€‚æ³¨æ„æ–‡ä»¶æœ€åä¸¤è¡Œçš„ selector éƒ¨åˆ†ï¼Œè¿™é‡Œå†³å®šäº†è¯·æ±‚ä¼šè¢«å‘é€ç»™é›†ç¾¤é‡Œçš„å“ªäº› podã€‚è¿™é‡Œçš„å®šä¹‰æ˜¯æ‰€æœ‰åŒ…å«ã€Œapp: k8s-demoã€è¿™ä¸ªæ ‡ç­¾çš„ podã€‚ç„¶è€Œæˆ‘ä»¬ä¹‹å‰éƒ¨ç½²çš„ pod å¹¶æ²¡æœ‰è®¾ç½®æ ‡ç­¾ï¼š
~~~~$ kubectl describe pods | grep Labels
Labels:		&lt;none&gt;~~~~
å¤åˆ¶ä»£ç æ‰€ä»¥è¦å…ˆæ›´æ–°ä¸€ä¸‹ pod.ymlï¼ŒæŠŠæ ‡ç­¾åŠ ä¸Šï¼ˆæ³¨æ„åœ¨ `metadata:` ä¸‹å¢åŠ äº† `labels `éƒ¨åˆ†ï¼‰ï¼š
~~~~apiVersion: v1
kind: Pod
metadata:
  name: k8s-demo
  labels:
    app: k8s-demo
spec:
  containers:
    - name: k8s-demo
      image: k8s-demo:0.1
      ports:
        - containerPort: 80~~~~
å¤åˆ¶ä»£ç ç„¶åæ›´æ–° pod å¹¶ç¡®è®¤æˆåŠŸæ–°å¢äº†æ ‡ç­¾ï¼š
~~~~$ kubectl apply -f pod.yml
pod &quot;k8s-demo&quot; configured
$ kubectl describe pods | grep Labels
Labels:		app=k8s-demo~~~~
å¤åˆ¶ä»£ç ç„¶åå°±å¯ä»¥åˆ›å»ºè¿™ä¸ª service äº†ï¼š
~~~~$ kubectl create -f svc.yml
service &quot;k8s-demo-svc&quot; created~~~~
å¤åˆ¶ä»£ç ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥å¾—åˆ°æš´éœ²å‡ºæ¥çš„ URLï¼Œåœ¨æµè§ˆå™¨é‡Œè®¿é—®ï¼Œå°±èƒ½çœ‹åˆ°æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„ç½‘é¡µäº†ã€‚
~~~~$ minikube service k8s-demo-svc --url
http://192.168.64.4:30050~~~~
å¤åˆ¶ä»£ç æ¨ªå‘æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ã€ç‰ˆæœ¬å›æ»š
åœ¨è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬æ¥å®éªŒä¸€ä¸‹åœ¨ä¸€ä¸ªé«˜å¯ç”¨æœåŠ¡çš„ç”Ÿäº§ç¯å¢ƒä¼šå¸¸ç”¨åˆ°çš„ä¸€äº›æ“ä½œã€‚åœ¨ç»§ç»­ä¹‹å‰ï¼Œå…ˆæŠŠåˆšæ‰éƒ¨ç½²çš„ pod åˆ é™¤ï¼ˆä½†æ˜¯ä¿ç•™ serviceï¼Œä¸‹é¢è¿˜ä¼šç”¨åˆ°ï¼‰ï¼š
~~~~$ kubectl delete pod k8s-demo
pod &quot;k8s-demo&quot; deleted~~~~
å¤åˆ¶ä»£ç åœ¨æ­£å¼ç¯å¢ƒä¸­æˆ‘ä»¬éœ€è¦è®©ä¸€ä¸ªæœåŠ¡ä¸å—å•ä¸ªèŠ‚ç‚¹æ•…éšœçš„å½±å“ï¼Œå¹¶ä¸”è¿˜è¦æ ¹æ®è´Ÿè½½å˜åŒ–åŠ¨æ€è°ƒæ•´èŠ‚ç‚¹æ•°é‡ï¼Œæ‰€ä»¥ä¸å¯èƒ½åƒä¸Šé¢ä¸€æ ·é€ä¸ªç®¡ç† podã€‚Kubernetes çš„ç”¨æˆ·é€šå¸¸æ˜¯ç”¨ Deployment æ¥ç®¡ç†æœåŠ¡çš„ã€‚ä¸€ä¸ª deployment å¯ä»¥åˆ›å»ºæŒ‡å®šæ•°é‡çš„ pod éƒ¨ç½²åˆ°å„ä¸ª node ä¸Šï¼Œå¹¶å¯å®Œæˆæ›´æ–°ã€å›æ»šç­‰æ“ä½œã€‚
é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®šä¹‰æ–‡ä»¶ deployment.ymlï¼š
~~~~apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: k8s-demo-deployment
spec:
  replicas: 10
  template:
    metadata:
      labels:
        app: k8s-demo
    spec:
      containers:
        - name: k8s-demo-pod
          image: k8s-demo:0.1
          ports:
            - containerPort: 80~~~~
å¤åˆ¶ä»£ç æ³¨æ„å¼€å§‹çš„ `apiVersion` å’Œä¹‹å‰ä¸ä¸€æ ·ï¼Œå› ä¸º Deployment API æ²¡æœ‰åŒ…å«åœ¨ v1 é‡Œï¼Œ`replicas: 10 `æŒ‡å®šäº†è¿™ä¸ª deployment è¦æœ‰ 10 ä¸ª podï¼Œåé¢çš„éƒ¨åˆ†å’Œä¹‹å‰çš„ pod å®šä¹‰ç±»ä¼¼ã€‚æäº¤è¿™ä¸ªæ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ª deploymentï¼š
~~~~$ kubectl create -f deployment.yml
deployment &quot;k8s-demo-deployment&quot; created~~~~
å¤åˆ¶ä»£ç ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°è¿™ä¸ª deployment çš„å‰¯æœ¬é›†ï¼ˆreplica setï¼‰ï¼Œæœ‰ 10 ä¸ª pod åœ¨è¿è¡Œã€‚
~~~~$ kubectl get rs
NAME                             DESIRED   CURRENT   READY     AGE
k8s-demo-deployment-774878f86f   10        10        10        19s~~~~
å¤åˆ¶ä»£ç å‡è®¾æˆ‘ä»¬å¯¹é¡¹ç›®åšäº†ä¸€äº›æ”¹åŠ¨ï¼Œè¦å‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚è¿™é‡Œä½œä¸ºç¤ºä¾‹ï¼Œæˆ‘ä»¬åªæŠŠ HTML æ–‡ä»¶çš„å†…å®¹æ”¹ä¸€ä¸‹, ç„¶åæ„å»ºä¸€ä¸ªæ–°ç‰ˆé•œåƒ k8s-demo:0.2ï¼š
~~~~$ echo '&lt;h1&gt;Hello Kubernetes!&lt;/h1&gt;' &gt; html/index.html
$ docker build -t k8s-demo:0.2 .~~~~
å¤åˆ¶ä»£ç ç„¶åæ›´æ–° deployment.ymlï¼š
a~~~~piVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: k8s-demo-deployment
spec:
  replicas: 10
  minReadySeconds: 10
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1
  template:
    metadata:
      labels:
        app: k8s-demo
    spec:
      containers:
        - name: k8s-demo-pod
          image: k8s-demo:0.2
          ports:
            - containerPort: 80~~~~
å¤åˆ¶ä»£ç è¿™é‡Œæœ‰ä¸¤ä¸ªæ”¹åŠ¨ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ›´æ–°äº†é•œåƒç‰ˆæœ¬å· `image: k8s-demo:0.2`ï¼Œç¬¬äºŒæ˜¯å¢åŠ äº† `minReadySeconds: 10 `å’Œ `strategy `éƒ¨åˆ†ã€‚æ–°å¢çš„éƒ¨åˆ†å®šä¹‰äº†æ›´æ–°ç­–ç•¥ï¼š`minReadySeconds: 10 `æŒ‡åœ¨æ›´æ–°äº†ä¸€ä¸ª pod åï¼Œéœ€è¦åœ¨å®ƒè¿›å…¥æ­£å¸¸çŠ¶æ€å 10 ç§’å†æ›´æ–°ä¸‹ä¸€ä¸ª podï¼›`maxUnavailable: 1 `æŒ‡åŒæ—¶å¤„äºä¸å¯ç”¨çŠ¶æ€çš„ pod ä¸èƒ½è¶…è¿‡ä¸€ä¸ªï¼›`maxSurge: 1 `æŒ‡å¤šä½™çš„ pod ä¸èƒ½è¶…è¿‡ä¸€ä¸ªã€‚è¿™æ · Kubernetes å°±ä¼šé€ä¸ªæ›¿æ¢ service åé¢çš„ podã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤å¼€å§‹æ›´æ–°ï¼š
~~~~$ kubectl apply -f deployment.yml --record=true
deployment &quot;k8s-demo-deployment&quot; configured~~~~
å¤åˆ¶ä»£ç è¿™é‡Œçš„ `--record=true` è®© Kubernetes æŠŠè¿™è¡Œå‘½ä»¤è®°åˆ°å‘å¸ƒå†å²ä¸­å¤‡æŸ¥ã€‚è¿™æ—¶å¯ä»¥é©¬ä¸Šè¿è¡Œä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹å„ä¸ª pod çš„çŠ¶æ€ï¼š
~~~~$ kubectl get pods
NAME                                   READY  STATUS        ...   AGE
k8s-demo-deployment-774878f86f-5wnf4   1/1    Running       ...   7m
k8s-demo-deployment-774878f86f-6kgjp   0/1    Terminating   ...   7m
k8s-demo-deployment-774878f86f-8wpd8   1/1    Running       ...   7m
k8s-demo-deployment-774878f86f-hpmc5   1/1    Running       ...   7m
k8s-demo-deployment-774878f86f-rd5xw   1/1    Running       ...   7m
k8s-demo-deployment-774878f86f-wsztw   1/1    Running       ...   7m
k8s-demo-deployment-86dbd79ff6-7xcxg   1/1    Running       ...   14s
k8s-demo-deployment-86dbd79ff6-bmvd7   1/1    Running       ...   1s
k8s-demo-deployment-86dbd79ff6-hsjx5   1/1    Running       ...   26s
k8s-demo-deployment-86dbd79ff6-mkn27   1/1    Running       ...   14s
k8s-demo-deployment-86dbd79ff6-pkmlt   1/1    Running       ...   1s
k8s-demo-deployment-86dbd79ff6-thh66   1/1    Running       ...   26s~~~~
å¤åˆ¶ä»£ç ä» AGE åˆ—å°±èƒ½çœ‹åˆ°æœ‰ä¸€éƒ¨åˆ† pod æ˜¯åˆšåˆšæ–°å»ºçš„ï¼Œæœ‰çš„ pod åˆ™è¿˜æ˜¯è€çš„ã€‚ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æ˜¾ç¤ºå‘å¸ƒçš„å®æ—¶çŠ¶æ€ï¼š
~~~~$ kubectl rollout status deployment k8s-demo-deployment
Waiting for rollout to finish: 1 old replicas are pending termination...
Waiting for rollout to finish: 1 old replicas are pending termination...
deployment &quot;k8s-demo-deployment&quot; successfully rolled out~~~~
å¤åˆ¶ä»£ç ç”±äºæˆ‘è¾“å…¥å¾—æ¯”è¾ƒæ™šï¼Œå‘å¸ƒå·²ç»å¿«è¦ç»“æŸï¼Œæ‰€ä»¥åªæœ‰ä¸‰è¡Œè¾“å‡ºã€‚ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹å‘å¸ƒå†å²ï¼Œå› ä¸ºç¬¬äºŒæ¬¡å‘å¸ƒä½¿ç”¨äº†` --record=true `æ‰€ä»¥å¯ä»¥çœ‹åˆ°ç”¨äºå‘å¸ƒçš„å‘½ä»¤ã€‚
~~~~$ kubectl rollout history deployment k8s-demo-deployment
deployments &quot;k8s-demo-deployment&quot;
REVISION	CHANGE-CAUSE
1		&lt;none&gt;
2		kubectl apply --filename=deploy.yml --record=true~~~~
å¤åˆ¶ä»£ç è¿™æ—¶å¦‚æœåˆ·æ–°æµè§ˆå™¨ï¼Œå°±å¯ä»¥çœ‹åˆ°æ›´æ–°çš„å†…å®¹ã€ŒHello Kubernetes!ã€ã€‚å‡è®¾æ–°ç‰ˆå‘å¸ƒåï¼Œæˆ‘ä»¬å‘ç°æœ‰ä¸¥é‡çš„ bugï¼Œéœ€è¦é©¬ä¸Šå›æ»šåˆ°ä¸Šä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨è¿™ä¸ªå¾ˆç®€å•çš„æ“ä½œï¼š
~~~~$ kubectl rollout undo deployment k8s-demo-deployment --to-revision=1
deployment &quot;k8s-demo-deployment&quot; rolled back~~~~
å¤åˆ¶ä»£ç Kubernetes ä¼šæŒ‰ç…§æ—¢å®šçš„ç­–ç•¥æ›¿æ¢å„ä¸ª podï¼Œä¸å‘å¸ƒæ–°ç‰ˆæœ¬ç±»ä¼¼ï¼Œåªæ˜¯è¿™æ¬¡æ˜¯ç”¨è€ç‰ˆæœ¬æ›¿æ¢æ–°ç‰ˆæœ¬ï¼š
~~~~$ kubectl rollout status deployment k8s-demo-deployment
Waiting for rollout to finish: 4 out of 10 new replicas have been updated...
Waiting for rollout to finish: 6 out of 10 new replicas have been updated...
Waiting for rollout to finish: 8 out of 10 new replicas have been updated...
Waiting for rollout to finish: 1 old replicas are pending termination...
deployment &quot;k8s-demo-deployment&quot; successfully rolled out~~~~
å¤åˆ¶ä»£ç åœ¨å›æ»šç»“æŸä¹‹åï¼Œåˆ·æ–°æµè§ˆå™¨å°±å¯ä»¥ç¡®è®¤ç½‘é¡µå†…å®¹åˆæ”¹å›äº†ã€ŒHello Docker!ã€ã€‚
ç»“è¯­
æˆ‘ä»¬ä»ä¸åŒå±‚é¢å®è·µäº†ä¸€éé•œåƒçš„æ„å»ºå’Œå®¹å™¨çš„éƒ¨ç½²ï¼Œå¹¶ä¸”éƒ¨ç½²äº†ä¸€ä¸ªæœ‰ 10 ä¸ªå®¹å™¨çš„ deployment, å®éªŒäº†æ»šåŠ¨æ›´æ–°å’Œå›æ»šçš„æµç¨‹ã€‚Kubernetes æä¾›äº†éå¸¸å¤šçš„åŠŸèƒ½ï¼Œæœ¬æ–‡åªæ˜¯ä»¥èµ°é©¬è§‚èŠ±çš„æ–¹å¼åšäº†ä¸€ä¸ªå¿«èŠ‚å¥çš„ walkthroughï¼Œç•¥è¿‡äº†å¾ˆå¤šç»†èŠ‚ã€‚è™½ç„¶ä½ è¿˜ä¸èƒ½åœ¨ç®€å†ä¸ŠåŠ ä¸Šã€Œç²¾é€š Kubernetesã€ï¼Œä½†æ˜¯åº”è¯¥å¯ä»¥åœ¨æœ¬åœ°çš„ Kubernetes ç¯å¢ƒæµ‹è¯•è‡ªå·±çš„å‰åç«¯é¡¹ç›®ï¼Œé‡åˆ°å…·ä½“çš„é—®é¢˜æ—¶æ±‚åŠ©äº Google å’Œå®˜æ–¹æ–‡æ¡£å³å¯ã€‚åœ¨æ­¤åŸºç¡€ä¸Šè¿›ä¸€æ­¥ç†Ÿæ‚‰åº”è¯¥å°±å¯ä»¥åœ¨åˆ«äººæä¾›çš„ Kubernetes ç”Ÿäº§ç¯å¢ƒå‘å¸ƒè‡ªå·±çš„æœåŠ¡ã€‚
LeanCloud çš„å¤§éƒ¨åˆ†æœåŠ¡éƒ½è¿è¡Œåœ¨åŸºäº Docker çš„åŸºç¡€è®¾æ–½ä¸Šï¼ŒåŒ…æ‹¬å„ä¸ª API æœåŠ¡ã€ä¸­é—´ä»¶ã€åç«¯ä»»åŠ¡ç­‰ã€‚å¤§éƒ¨åˆ†ä½¿ç”¨ LeanCloud çš„å¼€å‘è€…ä¸»è¦å·¥ä½œåœ¨å‰ç«¯ï¼Œä¸è¿‡äº‘å¼•æ“æ˜¯æˆ‘ä»¬çš„äº§å“ä¸­è®©å®¹å™¨æŠ€æœ¯ç¦»ç”¨æˆ·æœ€è¿‘çš„ã€‚äº‘å¼•æ“æä¾›äº†å®¹å™¨å¸¦æ¥çš„éš”ç¦»è‰¯å¥½ã€æ‰©å®¹ç®€ä¾¿ç­‰ä¼˜ç‚¹ï¼ŒåŒæ—¶åˆç›´æ¥æ”¯æŒå„ä¸ªè¯­è¨€çš„åŸç”Ÿä¾èµ–ç®¡ç†ï¼Œä¸ºç”¨æˆ·å…å»äº†é•œåƒæ„å»ºã€ç›‘æ§ã€æ¢å¤ç­‰è´Ÿæ‹…ï¼Œå¾ˆé€‚åˆå¸Œæœ›æŠŠç²¾åŠ›å®Œå…¨æŠ•å…¥åœ¨å¼€å‘ä¸Šçš„ç”¨æˆ·ã€‚
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä¸€ä»½ç®€æ˜çš„ Base64 åŸç†è§£æ]]></title>
        <id>https://th815.github.io/post/base64/</id>
        <link href="https://th815.github.io/post/base64/">
        </link>
        <updated>2020-09-13T13:05:40.000Z</updated>
        <content type="html"><![CDATA[<h2 id="1-base64-æ˜¯ä»€ä¹ˆ">1. Base64 æ˜¯ä»€ä¹ˆ</h2>
<blockquote>
<p>Base64 æ˜¯ä¸€ç§åŸºäº 64 ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„è¡¨ç¤ºæ–¹æ³•ã€‚ç”±äº 2^6=64ï¼Œæ‰€ä»¥æ¯ 6 ä¸ªæ¯”ç‰¹ä¸ºä¸€ä¸ªå•å…ƒï¼Œå¯¹åº”æŸä¸ªå¯æ‰“å°å­—ç¬¦ã€‚3 ä¸ªå­—èŠ‚æœ‰ 24 ä¸ªæ¯”ç‰¹ï¼Œå¯¹åº”äº 4 ä¸ª Base64 å•å…ƒï¼Œå³ 3 ä¸ªå­—èŠ‚å¯ç”± 4 ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºã€‚</p>
<p>â€”â€”ç»´åŸºç™¾ç§‘</p>
</blockquote>
<p>å®ƒä¸æ˜¯ä¸€ç§åŠ è§£å¯†æŠ€æœ¯ï¼Œæ˜¯ä¸€ç§ç®€å•çš„ç¼–è§£ç æŠ€æœ¯ã€‚</p>
<p>Base64 å¸¸ç”¨äºè¡¨ç¤ºã€ä¼ è¾“ã€å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼Œä¹Ÿå¯ä»¥ç”¨äºå°†ä¸€äº›å«æœ‰ç‰¹æ®Šå­—ç¬¦çš„æ–‡æœ¬å†…å®¹ç¼–ç ï¼Œä»¥ä¾¿ä¼ è¾“ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<ol>
<li>
<p>åœ¨ç”µå­é‚®ä»¶çš„ä¼ è¾“ä¸­ï¼ŒBase64 å¯ä»¥ç”¨æ¥å°† binary çš„å­—èŠ‚åºåˆ—ï¼Œæ¯”å¦‚é™„ä»¶ï¼Œç¼–ç æˆ ASCII å­—èŠ‚åºåˆ—ï¼›</p>
</li>
<li>
<p>å°†ä¸€äº›ä½“ç§¯ä¸å¤§çš„å›¾ç‰‡ Base64 ç¼–ç åï¼Œç›´æ¥å†…åµŒåˆ°ç½‘é¡µæºç é‡Œï¼›</p>
</li>
<li>
<p>å°†è¦ä¼ é€’ç»™ HTTP è¯·æ±‚çš„å‚æ•°åšç®€å•çš„è½¬æ¢ï¼Œé™ä½è‚‰çœ¼å¯è¯»æ€§ï¼›</p>
<p><em>æ³¨ï¼šç”¨äº URL çš„ Base64 éæ ‡å‡† Base64ï¼Œæ˜¯ä¸€ç§å˜ç§ã€‚</em></p>
</li>
<li>
<p>ç½‘å‹ä»¬åœ¨è®ºå›ç­‰å…¬å¼€åœºåˆä¹ æƒ¯å°†é‚®ç®±åœ°å€ Base64 åå†å‘å‡ºæ¥ï¼Œé˜²æ­¢è¢«çˆ¬è™«æŠ“å–åå‘é€åƒåœ¾é‚®ä»¶ã€‚</p>
</li>
</ol>
<h2 id="2-base64-ç¼–ç åŸç†">2. Base64 ç¼–ç åŸç†</h2>
<p>æ ‡å‡† Base64 é‡Œçš„ 64 ä¸ªå¯æ‰“å°å­—ç¬¦æ˜¯ <code>A-Za-z0-9+/</code>ï¼Œåˆ†åˆ«ä¾æ¬¡å¯¹åº”ç´¢å¼•å€¼ 0-63ã€‚ç´¢å¼•è¡¨å¦‚ä¸‹ï¼š</p>
<figure data-type="image" tabindex="1"><img src="/images/posts/java/base64-index.png" alt="" loading="lazy"></figure>
<p>ç¼–ç æ—¶ï¼Œæ¯ 3 ä¸ªå­—èŠ‚ä¸€ç»„ï¼Œå…± 8bit*3=24bitï¼Œåˆ’åˆ†æˆ 4 ç»„ï¼Œå³æ¯ 6bit ä»£è¡¨ä¸€ä¸ªç¼–ç åçš„ç´¢å¼•å€¼ï¼Œåˆ’åˆ†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure data-type="image" tabindex="2"><img src="/images/posts/java/base64-split.png" alt="" loading="lazy"></figure>
<p>è¿™æ ·å¯èƒ½ä¸å¤ªç›´è§‚ï¼Œä¸¾ä¸ªä¾‹å­å°±å®¹æ˜“ç†è§£äº†ã€‚æ¯”å¦‚æˆ‘ä»¬å¯¹ <code>cat</code> è¿›è¡Œç¼–ç ï¼š</p>
<figure data-type="image" tabindex="3"><img src="/images/posts/java/base64-example.jpeg" alt="" loading="lazy"></figure>
<p>å¯ä»¥çœ‹åˆ° <code>cat</code> ç¼–ç åå˜æˆäº† <code>Y2F0</code>ã€‚</p>
<p>å¦‚æœå¾…ç¼–ç å†…å®¹çš„å­—èŠ‚æ•°ä¸æ˜¯ 3 çš„æ•´æ•°å€ï¼Œé‚£éœ€è¦è¿›è¡Œä¸€äº›é¢å¤–çš„å¤„ç†ã€‚</p>
<p>å¦‚æœæœ€åå‰©ä¸‹ 1 ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå°†è¡¥ 4 ä¸ª 0 ä½ï¼Œç¼–ç æˆ 2 ä¸ª Base64 å­—ç¬¦ï¼Œç„¶åè¡¥ä¸¤ä¸ª <code>=</code>ï¼š</p>
<figure data-type="image" tabindex="4"><img src="/images/posts/java/base64-padding2.png" alt="" loading="lazy"></figure>
<p>å¦‚æœæœ€åå‰©ä¸‹ 2 ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå°†è¡¥ 2 ä¸ª 0 ä½ï¼Œç¼–ç æˆ 3 ä¸ª Base64 å­—ç¬¦ï¼Œç„¶åè¡¥ä¸€ä¸ª <code>=</code>ï¼š</p>
<figure data-type="image" tabindex="5"><img src="/images/posts/java/base64-padding1.png" alt="" loading="lazy"></figure>
<h2 id="3-å®ç°ä¸€ä¸ªç®€æ˜“çš„-base64-ç¼–ç å™¨">3. å®ç°ä¸€ä¸ªç®€æ˜“çš„ Base64 ç¼–ç å™¨</h2>
<p>è®²å®ŒåŸç†ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŠ¨æ‰‹å®ç°ä¸€ä¸ªç®€æ˜“çš„æ ‡å‡† Base64 ç¼–ç å™¨äº†ï¼Œä»¥ä¸‹æ˜¯æˆ‘å‚è€ƒ Java 8 çš„ java.util.Base64 ä¹±å†™çš„ä¸€ä¸ª Java ç‰ˆæœ¬ï¼Œä»…ä¾›å‚è€ƒï¼Œä¸»è¦åŠŸèƒ½ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public class CustomBase64Encoder {

    /**
     * ç´¢å¼•è¡¨
     */
    private static final char[] sBase64 = {
            'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',
            'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',
            'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',
            'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',
            'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',
            'o', 'p', 'q', 'r', 's', 't', 'u', 'v',
            'w', 'x', 'y', 'z', '0', '1', '2', '3',
            '4', '5', '6', '7', '8', '9', '+', '/'
    };

    /**
     * å°† byte[] è¿›è¡Œ Base64 ç¼–ç å¹¶è¿”å›å­—ç¬¦ä¸²
     * @param src åŸæ–‡
     * @return ç¼–ç åçš„å­—ç¬¦ä¸²
     */
    public static String encode(byte[] src) {
        if (src == null) {
            return null;
        }

        byte[] dst = new byte[(src.length + 2) / 3 * 4];

        int index = 0;

        // æ¯æ¬¡å°† 3 ä¸ªå­—èŠ‚ç¼–ç ä¸º 4 ä¸ªå­—èŠ‚
        for (int i = 0; i &lt; (src.length / 3 * 3); i += 3) {
            int bits = (src[i] &amp; 0xff) &lt;&lt; 16 | (src[i + 1] &amp; 0xff) &lt;&lt; 8 | (src[i + 2] &amp; 0xff);
            dst[index++] = (byte) sBase64[(bits &gt;&gt;&gt; 18) &amp; 0x3f];
            dst[index++] = (byte) sBase64[(bits &gt;&gt;&gt; 12) &amp; 0x3f];
            dst[index++] = (byte) sBase64[(bits &gt;&gt;&gt; 6) &amp; 0x3f];
            dst[index++] = (byte) sBase64[bits &amp; 0x3f];
        }

        // å¤„ç†å‰©ä¸‹çš„ 1 ä¸ªæˆ– 2 ä¸ªå­—èŠ‚
        if (src.length % 3 == 1) {
            int bits = (src[src.length - 1] &amp; 0xff) &lt;&lt; 4;
            dst[index++] = (byte) sBase64[(bits &gt;&gt;&gt; 6) &amp; 0x3f];
            dst[index++] = (byte) sBase64[bits &amp; 0x3f];
            dst[index++] = '=';
            dst[index] = '=';
        } else if (src.length % 3 == 2) {
            int bits = (src[src.length - 2] &amp; 0xff) &lt;&lt; 10 | (src[src.length - 1] &amp; 0xff) &lt;&lt; 2;
            dst[index++] = (byte) sBase64[(bits &gt;&gt;&gt; 12) &amp; 0x3f];
            dst[index++] = (byte) sBase64[(bits &gt;&gt;&gt; 6) &amp; 0x3f];
            dst[index++] = (byte) sBase64[bits &amp; 0x3f];
            dst[index] = '=';
        }

        return new String(dst);
    }
}
</code></pre>
<h2 id="4-å…¶å®ƒçŸ¥è¯†ç‚¹">4. å…¶å®ƒçŸ¥è¯†ç‚¹</h2>
<h3 id="41-ä¸ºä»€ä¹ˆæœ‰çš„ç¼–ç ç»“æœå¸¦å›è½¦">4.1 ä¸ºä»€ä¹ˆæœ‰çš„ç¼–ç ç»“æœå¸¦å›è½¦</h3>
<p>åœ¨ç”µå­é‚®ä»¶ä¸­ï¼Œæ ¹æ® RFC 822 è§„å®šï¼Œæ¯ 76 ä¸ªå­—ç¬¦éœ€è¦åŠ ä¸Šä¸€ä¸ªå›è½¦æ¢è¡Œï¼Œæ‰€ä»¥æœ‰äº›ç¼–ç å™¨å®ç°ï¼Œæ¯”å¦‚ sun.misc.BASE64Encoder.encodeï¼Œæ˜¯å¸¦å›è½¦çš„ï¼Œè¿˜æœ‰ java.util.Base64.Encoder.RFC2045ï¼Œæ˜¯å¸¦å›è½¦æ¢è¡Œçš„ï¼Œæ¯è¡Œ 76 ä¸ªå­—ç¬¦ã€‚</p>
<h3 id="42-base64-çš„å˜ç§">4.2 Base64 çš„å˜ç§</h3>
<p>é™¤äº†æ ‡å‡† Base64 ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶å®ƒçš„ Base64 å˜ç§ã€‚</p>
<p>æ¯”å¦‚åœ¨ URL çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œå› ä¸ºæ ‡å‡† Base64 ç´¢å¼•è¡¨ä¸­çš„ <code>/</code> å’Œ <code>+</code> ä¼šè¢« URLEncoder è½¬ä¹‰æˆ <code>%XX</code> å½¢å¼ï¼Œä½† <code>%</code> æ˜¯ SQL ä¸­çš„é€šé…ç¬¦ï¼Œç›´æ¥ç”¨äºæ•°æ®åº“æ“ä½œä¼šæœ‰é—®é¢˜ã€‚æ­¤æ—¶å¯ä»¥é‡‡ç”¨ URL Safe çš„ç¼–ç å™¨ï¼Œç´¢å¼•è¡¨ä¸­çš„ <code>/+</code> è¢«æ¢æˆ <code>-_</code>ï¼Œæ¯”å¦‚ java.util.Base64.Encoder.RFC4648_URLSAFE å°±æ˜¯è¿™æ ·çš„å®ç°ã€‚</p>
<h2 id="5-å‚è€ƒé“¾æ¥">5. å‚è€ƒé“¾æ¥</h2>
<ul>
<li><a href="https://zh.wikipedia.org/zh-hans/Base64">https://zh.wikipedia.org/zh-hans/Base64</a></li>
<li><a href="https://www.liaoxuefeng.com/wiki/897692888725344/949441536192576">https://www.liaoxuefeng.com/wiki/897692888725344/949441536192576</a></li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[âŒšï¸æ–‡å­—å›¾ç‰‡æµ‹è¯•]]></title>
        <id>https://th815.github.io/post/2020-09-12/</id>
        <link href="https://th815.github.io/post/2020-09-12/">
        </link>
        <updated>2020-09-12T08:09:15.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿æ¥åˆ°<strong>ç”°æ˜Š</strong>çš„ä¸ªäººå°ç«™ ï¼<br>
âœï¸  <strong>tianhao.tech</strong> ä¸€ä¸ªé™æ€é¡µé¢çš„åšå®¢ï¼Œæˆ‘ç”¨å®ƒæ¥è®°å½•ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿æ¥åˆ°<strong>ç”°æ˜Š</strong>çš„ä¸ªäººå°ç«™ ï¼<br>
âœï¸  <strong>tianhao.tech</strong> ä¸€ä¸ªé™æ€é¡µé¢çš„åšå®¢ï¼Œæˆ‘ç”¨å®ƒæ¥è®°å½•ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<h1 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h1>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤š<br>
å¹³å°<br>
ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<h2 id="å›¾ç‰‡æµ‹è¯•">å›¾ç‰‡æµ‹è¯•</h2>
<p><img src="https://th815.github.io/post-images/1599902337333.jpg" alt="" loading="lazy"><br>
è¿™é‡Œåº”è¯¥æ˜¯ä¸€å¼ å›¾ç‰‡</p>
<ul>
<li>æ˜Ÿå·<br>
<strong>åŒâ€œæ˜Ÿå·â€æµ‹è¯•</strong></li>
</ul>
<!-- more -->
<p>åˆ†éš”ç¬¦</p>
<pre><code>class MyClass {
  public static myValue: string;
  constructor(init: string) {
    this.myValue = init;
  }
}
import fs = require(&quot;fs&quot;);
module MyModule {
  export interface MyInterface extends Other {
    myProperty: any;
  }
}
declare magicNumber number;
myArray.forEach(() =&gt; { }); // fat arrow syntax`

</code></pre>
<h2 id="ä»£ç é«˜äº®">ä»£ç é«˜äº®</h2>
<pre><code>`class MyClass {
  public static myValue: string;
  constructor(init: string) {
    this.myValue = init;
  }
}
import fs = require(&quot;fs&quot;);
module MyModule {
  export interface MyInterface extends Other {
    myProperty: any;
  }
}
declare magicNumber number;
myArray.forEach(() =&gt; { }); // fat arrow syntax`
</code></pre>
<h2 id="å±…ä¸­">å±…ä¸­</h2>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">é’±</mi><mi mathvariant="normal">ğŸ’°</mi></mrow><annotation encoding="application/x-tex">é’±ğŸ’° 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0em;vertical-align:0em;"></span><span class="mord cjk_fallback">é’±</span><span class="mord">ğŸ’°</span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">æµ‹</mi><mi mathvariant="normal">è¯•</mi></mrow><annotation encoding="application/x-tex">æµ‹è¯• 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0em;vertical-align:0em;"></span><span class="mord cjk_fallback">æµ‹</span><span class="mord cjk_fallback">è¯•</span></span></span></span></span></p>
<h2 id="åˆ—è¡¨æµ‹è¯•">åˆ—è¡¨æµ‹è¯•</h2>
<ul>
<li>åˆ—è¡¨</li>
<li>æµ‹è¯•1</li>
<li>ver</li>
</ul>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>